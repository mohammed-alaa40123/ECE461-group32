{"code":"(()=>{\n\"use strict\";var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __hasOwnProp=Object.prototype.hasOwnProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:true})};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from===\"object\"||typeof from===\"function\"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toCommonJS=mod=>__copyProps(__defProp({},\"__esModule\",{value:true}),mod);var busFactor_exports={};__export(busFactor_exports,{calculateBusFactorScore:()=>calculateBusFactorScore});module.exports=__toCommonJS(busFactor_exports);var import_graphqlClient=require(\"../graphqlClient\");var import_logger=require(\"../logger\");const logger=(0,import_logger.getLogger)();async function calculateBusFactorScore(repoOwner,repoName){try{const since=new Date(new Date().setMonth(new Date().getMonth()-30)).toISOString();let hasNextPage=true;let cursor=null;const commitData=new Map;while(hasNextPage){const data=await import_graphqlClient.graphqlClient.request(import_graphqlClient.GET_VALUES_FOR_BUS_FACTOR,{repoOwner,repoName,since,after:cursor});const history=data.repository.defaultBranchRef.target.history;history.edges.forEach(({node})=>{const login=node.author.user?.login;if(login){commitData.set(login,(commitData.get(login)||0)+1)}});cursor=history.pageInfo.endCursor;hasNextPage=history.pageInfo.hasNextPage}const score=calculateBusFactor90thPercentile(commitData);logger.debug(`Bus factor score for ${repoOwner}/${repoName}: ${score}`);return score}catch(error){logger.info(\"Error calculating bus factor score:\",error);return 0}}__name(calculateBusFactorScore,\"calculateBusFactorScore\");function calculateBusFactor90thPercentile(commitData){const commitCounts=Array.from(commitData.values());commitCounts.sort((a,b)=>a-b);const totalContributors=commitCounts.length;if(totalContributors===0)return 0;const percentileIndex=Math.floor(.9*totalContributors);const threshold=commitCounts[Number(percentileIndex)];const aboveThresholdContributors=commitCounts.filter(count=>count>=threshold).length;const score=Math.min(1,Math.max(Math.round(aboveThresholdContributors*.05*100)/100,0));return score}__name(calculateBusFactor90thPercentile,\"calculateBusFactor90thPercentile\");0&&(module.exports={calculateBusFactorScore});\n})()\n","warnings":[],"map":{"version":3,"mappings":";mvBAAA,0JAGA,yBAAyD,4BAEzD,kBAA0B,qBAE1B,MAAM,UAAS,yBAAU,EAQzB,eAAsB,wBAAwB,UAAmB,SAAmC,CAClG,GAAI,CAEF,MAAM,MAAQ,IAAI,KAAK,IAAI,KAAK,EAAE,SAAS,IAAI,KAAK,EAAE,SAAS,EAAI,EAAE,CAAC,EAAE,YAAY,EACpF,IAAI,YAAc,KAClB,IAAI,OAAwB,KAC5B,MAAM,WAAa,IAAI,IAGvB,MAAO,YAAa,CAClB,MAAM,KAA0B,MAAM,mCAAc,QAAQ,+CAA2B,CACrF,UACA,SACA,MACA,MAAO,MACT,CAAC,EAED,MAAM,QAAU,KAAK,WAAW,iBAAiB,OAAO,QAGxD,QAAQ,MAAM,QAAQ,CAAC,CAAE,IAAK,IAAM,CAClC,MAAM,MAAQ,KAAK,OAAO,MAAM,MAChC,GAAI,MAAO,CACT,WAAW,IAAI,OAAQ,WAAW,IAAI,KAAK,GAAK,GAAK,CAAC,CACxD,CACF,CAAC,EAGD,OAAS,QAAQ,SAAS,UAC1B,YAAc,QAAQ,SAAS,WACjC,CAGA,MAAM,MAAQ,iCAAiC,UAAU,EAEzD,OAAO,MAAM,wBAAwB,SAAS,IAAI,QAAQ,KAAK,KAAK,EAAE,EACtE,OAAO,KACT,OAAS,MAAO,CACd,OAAO,KAAK,sCAAuC,KAAK,EACxD,MAAO,EACT,CACF,CAzCsB,0DAkDtB,SAAS,iCAAiC,WAAyC,CACjF,MAAM,aAAe,MAAM,KAAK,WAAW,OAAO,CAAC,EACnD,aAAa,KAAK,CAAC,EAAG,IAAM,EAAI,CAAC,EAEjC,MAAM,kBAAoB,aAAa,OACvC,GAAI,oBAAsB,EAAG,MAAO,GAGpC,MAAM,gBAAkB,KAAK,MAAM,GAAM,iBAAiB,EAC1D,MAAM,UAAY,aAAa,OAAO,eAAe,CAAC,EAGtD,MAAM,2BAA6B,aAAa,OAAQ,OAAU,OAAS,SAAS,EAAE,OACtF,MAAM,MAAQ,KAAK,IAAI,EAAG,KAAK,IAAI,KAAK,MAAM,2BAA6B,IAAO,GAAG,EAAI,IAAK,CAAC,CAAC,EAChG,OAAO,KACT,CAfS","names":[],"ignoreList":[],"sources":["D:\\Purdue\\s1\\46100\\local\\ECE461-group32\\backend\\src\\rating\\metrics\\busFactor.ts"],"sourcesContent":[null]}}