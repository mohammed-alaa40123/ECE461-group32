(()=>{var e={490:function(e,t,s){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var a=Object.getOwnPropertyDescriptor(t,s);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,a)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&n(t,e,s);return a(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.handleGetTracks=t.handleGetPackageCost=t.handleGetPackageRating=t.handleSearchPackagesByRegEx=t.handleGetPackageHistoryByName=t.handleResetRegistry=t.handleListPackages=t.handleDeletePackage=t.handleUpdatePackage=t.handleRetrievePackage=t.handleCreatePackage=t.handleAuthenticate=void 0;const i=r(s(59)),c=s(139),d=s(748),u=s(521),p=o(s(829)),l=o(s(486));t.handleAuthenticate=async e=>{const{User:t,Secret:s}=JSON.parse(e),{name:n,isAdmin:a}=t,{password:r}=s;if(!n||"boolean"!=typeof a||!r)return(0,d.sendResponse)(400,{message:"Missing fields in AuthenticationRequest"});try{const e=await(0,i.getUserByName)(n);if(!e)return(0,d.sendResponse)(401,{message:"Invalid user or password."});if(!await l.default.compare(r,e.password_hash))return(0,d.sendResponse)(401,{message:"Invalid user or password."});const t=p.default.sign({sub:e.id,name:e.name,isAdmin:e.isAdmin},process.env.JWT_SECRET,{expiresIn:process.env.JWT_EXPIRES_IN||"1h"});return(0,d.sendResponse)(200,{token:`bearer ${t}`})}catch(e){return console.error("Authentication Error:",e),(0,d.sendResponse)(500,{message:"Internal server error."})}},t.handleCreatePackage=async(e,t)=>{const s=JSON.parse(e),{metadata:n,data:a}=s;if(!(n&&n.Name&&n.Version&&n.ID))return(0,d.sendResponse)(400,{message:"Missing required package metadata fields."});if(a.Content&&a.URL||!a.Content&&!a.URL)return(0,d.sendResponse)(400,{message:"Either Content or URL must be set, but not both."});try{const e=await(0,i.createPackage)(n,a);a.Content&&await(0,c.uploadPackageContent)(n.ID,a.Content);const t="\n      INSERT INTO package_history (package_id, user_id, action)\n      VALUES ($1, $2, $3)\n    ";return await i.default.query(t,[n.ID,5445,"CREATE"]),(0,d.sendResponse)(201,e)}catch(e){return console.error("Create Package Error:",e),"23505"===e.code?(0,d.sendResponse)(409,{message:"Package exists already."}):(0,d.sendResponse)(500,{message:"Internal server error."})}},t.handleRetrievePackage=async(e,t)=>{let s;try{s=(0,u.authenticate)(t)}catch(e){return(0,d.sendResponse)(e.statusCode,{message:e.message})}try{const t="SELECT * FROM packages WHERE id = $1",n=await i.default.query(t,[e]);if(0===n.rows.length)return(0,d.sendResponse)(404,{message:"Package does not exist."});const a=n.rows[0];if(!a.data.Content&&!a.data.URL)try{const t=await(0,c.getPackageContent)(e);a.data.Content=t}catch(e){return console.error("S3 Retrieval Error:",e),(0,d.sendResponse)(500,{message:"Failed to retrieve package content."})}const r="\n      INSERT INTO package_history (package_id, user_id, action)\n      VALUES ($1, $2, $3)\n    ";return await i.default.query(r,[e,s.sub,"DOWNLOAD"]),(0,d.sendResponse)(200,a)}catch(e){return console.error("Retrieve Package Error:",e),(0,d.sendResponse)(500,{message:"Internal server error."})}},t.handleUpdatePackage=async(e,t,s)=>{let n;try{n=(0,u.authenticate)(s)}catch(e){return(0,d.sendResponse)(e.statusCode,{message:e.message})}const a=JSON.parse(t),{metadata:r,data:o}=a;if(r.ID!==e)return(0,d.sendResponse)(400,{message:"Metadata ID does not match the path ID."});try{const t=[],s=[];let a=1;o.Content?(t.push("content = $"+a++),s.push(o.Content)):o.URL&&(t.push("url = $"+a++),s.push(o.URL)),t.push("debloat = $"+a++),s.push(o.debloat||!1),o.JSProgram&&(t.push("js_program = $"+a++),s.push(o.JSProgram)),t.push("updated_at = NOW()");const r=`UPDATE packages SET ${t.join(", ")} WHERE id = $${a} RETURNING *`;s.push(e);const u=await i.default.query(r,s);if(0===u.rows.length)return(0,d.sendResponse)(404,{message:"Package does not exist."});const p=u.rows[0];o.Content&&await(0,c.uploadPackageContent)(e,o.Content);const l="\n      INSERT INTO package_history (package_id, user_id, action)\n      VALUES ($1, $2, $3)\n    ";return await i.default.query(l,[e,n.sub,"UPDATE"]),(0,d.sendResponse)(200,p)}catch(e){return console.error("Update Package Error:",e),(0,d.sendResponse)(500,{message:"Internal server error."})}},t.handleDeletePackage=async(e,t)=>{let s;try{s=(0,u.authenticate)(t)}catch(e){return(0,d.sendResponse)(e.statusCode,{message:e.message})}try{const t="DELETE FROM packages WHERE id = $1 RETURNING *",n=await i.default.query(t,[e]);if(0===n.rows.length)return(0,d.sendResponse)(404,{message:"Package does not exist."});n.rows[0].data.Content&&await(0,c.deletePackageContent)(e);const a="\n      INSERT INTO package_history (package_id, user_id, action)\n      VALUES ($1, $2, $3)\n    ";return await i.default.query(a,[e,s.sub,"DELETE"]),(0,d.sendResponse)(200,{message:"Package is deleted."})}catch(e){return console.error("Delete Package Error:",e),(0,d.sendResponse)(500,{message:"Internal server error."})}},t.handleListPackages=async(e,t,s)=>{let n;try{n=(0,u.authenticate)(t)}catch(e){return(0,d.sendResponse)(e.statusCode,{message:e.message})}const a=JSON.parse(e),r=s&&s.offset?parseInt(s.offset):0;if(!Array.isArray(a))return(0,d.sendResponse)(400,{message:"Request body must be an array of PackageQuery."});try{const e=[];for(const t of a){const{Name:s,Version:n}=t;if(!s)return(0,d.sendResponse)(400,{message:"PackageQuery must include Name."});let a="SELECT * FROM packages WHERE name ILIKE $1";const r=[`%${s}%`];n&&(a+=" AND version = $2",r.push(n));const o=await i.default.query(a,r);e.push(...o.rows)}const t=e.slice(r,r+10),s=r+10<e.length?r+10:null,n={};return null!==s&&(n.offset=s.toString()),{statusCode:200,headers:n,body:JSON.stringify(t)}}catch(e){return console.error("List Packages Error:",e),e.message.includes("too many")?(0,d.sendResponse)(413,{message:"Too many packages returned."}):(0,d.sendResponse)(500,{message:"Internal server error."})}},t.handleResetRegistry=async e=>{let t;try{if(t=(0,u.authenticate)(e),!t.isAdmin)return(0,d.sendResponse)(403,{message:"Admin privileges required."})}catch(e){return(0,d.sendResponse)(e.statusCode,{message:e.message})}try{return await i.default.query("TRUNCATE TABLE packages CASCADE;"),await i.default.query("TRUNCATE TABLE package_history CASCADE;"),(0,d.sendResponse)(200,{message:"Registry is reset."})}catch(e){return console.error("Reset Registry Error:",e),(0,d.sendResponse)(500,{message:"Internal server error."})}},t.handleGetPackageHistoryByName=async(e,t)=>{let s;try{s=(0,u.authenticate)(t)}catch(e){return(0,d.sendResponse)(e.statusCode,{message:e.message})}try{const t="\n      SELECT ph.*, u.name as user_name, u.is_admin\n      FROM package_history ph\n      JOIN packages p ON ph.package_id = p.id\n      JOIN users u ON ph.user_id = u.id\n      WHERE p.name ILIKE $1\n      ORDER BY ph.date DESC\n    ",s=await i.default.query(t,[`%${e}%`]);if(0===s.rows.length)return(0,d.sendResponse)(404,{message:"No such package."});const n=s.rows.map((e=>({User:{name:e.user_name,isAdmin:e.is_admin},Date:e.date.toISOString(),PackageMetadata:{Name:e.name,Version:e.version,ID:e.package_id},Action:e.action})));return(0,d.sendResponse)(200,n)}catch(e){return console.error("Get Package History Error:",e),(0,d.sendResponse)(500,{message:"Internal server error."})}},t.handleSearchPackagesByRegEx=async(e,t)=>{let s;try{s=(0,u.authenticate)(t)}catch(e){return(0,d.sendResponse)(e.statusCode,{message:e.message})}const{RegEx:n}=JSON.parse(e);if(!n)return(0,d.sendResponse)(400,{message:"Missing RegEx field in PackageRegEx."});try{const e="\n      SELECT * FROM packages\n      WHERE name ~* $1 OR readme ~* $1\n    ",t=await i.default.query(e,[n]);if(0===t.rows.length)return(0,d.sendResponse)(404,{message:"No package found under this regex."});const s=t.rows.map((e=>({Version:e.version,Name:e.name,ID:e.id})));return(0,d.sendResponse)(200,s)}catch(e){return console.error("Search Packages Error:",e),(0,d.sendResponse)(500,{message:"Internal server error."})}},t.handleGetPackageRating=async(e,t)=>{let s;try{s=(0,u.authenticate)(t)}catch(e){return(0,d.sendResponse)(e.statusCode,{message:e.message})}try{const t="SELECT * FROM package_ratings WHERE package_id = $1",s=await i.default.query(t,[e]);if(0===s.rows.length)return(0,d.sendResponse)(500,{message:"The package rating system choked on at least one of the metrics."});const n=s.rows[0];return(0,d.sendResponse)(200,n)}catch(e){return console.error("Get Package Rating Error:",e),(0,d.sendResponse)(500,{message:"Internal server error."})}},t.handleGetPackageCost=async(e,t,s)=>{let n;try{n=(0,u.authenticate)(t)}catch(e){return(0,d.sendResponse)(e.statusCode,{message:e.message})}const a=s&&"true"===s.dependency;try{const t="\n      SELECT p.id, p.name, p.version, p.size_mb\n      FROM packages p\n      WHERE p.id = $1\n    ";if(0===(await i.default.query(t,[e])).rows.length)return(0,d.sendResponse)(404,{message:"Package does not exist."});const s={};let n=0;const r=[e],o=new Set;for(;r.length>0;){const e=r.pop();if(o.has(e))continue;o.add(e);const t="SELECT * FROM packages WHERE id = $1",c=await i.default.query(t,[e]);if(0===c.rows.length)continue;const d=c.rows[0];if(s[d.id]={standaloneCost:d.size_mb,totalCost:d.size_mb},n+=d.size_mb,a){const t="SELECT dependency_id FROM dependencies WHERE package_id = $1";(await i.default.query(t,[e])).rows.forEach((e=>{o.has(e.dependency_id)||(r.push(e.dependency_id),n+=e.size_mb)}))}}if(a){let e=0;for(const t in s)e+=s[t].standaloneCost||0,s[t].totalCost=e}else s[e].totalCost=s[e].standaloneCost||0;return(0,d.sendResponse)(200,s)}catch(e){return console.error("Get Package Cost Error:",e),(0,d.sendResponse)(500,{message:"Internal server error."})}},t.handleGetTracks=async e=>{let t;try{t=(0,u.authenticate)(e)}catch(e){return(0,d.sendResponse)(e.statusCode,{message:e.message})}try{const e="\n      SELECT t.track_name\n      FROM user_tracks ut\n      JOIN tracks t ON ut.track_id = t.id\n      WHERE ut.user_id = $1\n    ",s=(await i.default.query(e,[t.sub])).rows.map((e=>e.track_name));return(0,d.sendResponse)(200,{plannedTracks:s})}catch(e){return console.error("Get Tracks Error:",e),(0,d.sendResponse)(500,{message:"The system encountered an error while retrieving the student's track information."})}}},59:function(e,t,s){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createPackage=t.getUserByName=void 0;const a=n(s(599)),r=s(449);a.default.config();const o=new r.Pool({host:process.env.RDS_HOST,user:process.env.RDS_USER,password:process.env.RDS_PASSWORD,database:process.env.RDS_DATABASE,port:parseInt(process.env.RDS_PORT||"5432"),max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3,ssl:{rejectUnauthorized:!1}});t.default=o,t.getUserByName=async e=>{const t=await o.query("SELECT * FROM users WHERE name = $1",[e]);return 0===t.rows.length?null:t.rows[0]},t.createPackage=async(e,t)=>{const s=[e.ID,e.Name,e.Version,t.Content||null,t.URL||null,t.debloat||!1,t.JSProgram||null];return(await o.query("\n    INSERT INTO packages (id, name, version, content, url, debloat, js_program)\n    VALUES ($1, $2, $3, $4, $5, $6, $7)\n    RETURNING *;\n  ",s)).rows[0]}},139:function(e,t,s){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deletePackageContent=t.getPackageContent=t.uploadPackageContent=void 0;const a=new(n(s(496)).default.S3);t.uploadPackageContent=async(e,t)=>{const s={Bucket:process.env.S3_BUCKET,Key:`packages/${e}.zip`,Body:Buffer.from(t,"base64")};await a.putObject(s).promise()},t.getPackageContent=async e=>{const t={Bucket:process.env.S3_BUCKET,Key:`packages/${e}.zip`};return(await a.getObject(t).promise()).Body.toString("base64")},t.deletePackageContent=async e=>{const t={Bucket:process.env.S3_BUCKET,Key:`packages/${e}.zip`};await a.deleteObject(t).promise()}},521:function(e,t,s){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.authenticate=void 0;const a=n(s(829));t.authenticate=e=>{const t=e["X-Authorization"]||e["x-authorization"];if(!t)throw{statusCode:403,message:"Missing Authentication Token"};const s=t.split(" ");if(2!==s.length||"bearer"!==s[0].toLowerCase())throw{statusCode:403,message:"Invalid Authentication Token"};const n=s[1];try{return a.default.verify(n,process.env.JWT_SECRET)}catch(e){throw{statusCode:403,message:"Invalid Authentication Token"}}}},748:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendResponse=void 0,t.sendResponse=(e,t)=>({statusCode:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})},599:(e,t,s)=>{const n=s(896),a=s(928),r=s(857),o=s(982),i=s(583).version,c=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;function d(e){console.log(`[dotenv@${i}][DEBUG] ${e}`)}function u(e){return e&&e.DOTENV_KEY&&e.DOTENV_KEY.length>0?e.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function p(e,t){let s;try{s=new URL(t)}catch(e){if("ERR_INVALID_URL"===e.code){const e=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw e.code="INVALID_DOTENV_KEY",e}throw e}const n=s.password;if(!n){const e=new Error("INVALID_DOTENV_KEY: Missing key part");throw e.code="INVALID_DOTENV_KEY",e}const a=s.searchParams.get("environment");if(!a){const e=new Error("INVALID_DOTENV_KEY: Missing environment part");throw e.code="INVALID_DOTENV_KEY",e}const r=`DOTENV_VAULT_${a.toUpperCase()}`,o=e.parsed[r];if(!o){const e=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${r} in your .env.vault file.`);throw e.code="NOT_FOUND_DOTENV_ENVIRONMENT",e}return{ciphertext:o,key:n}}function l(e){let t=null;if(e&&e.path&&e.path.length>0)if(Array.isArray(e.path))for(const s of e.path)n.existsSync(s)&&(t=s.endsWith(".vault")?s:`${s}.vault`);else t=e.path.endsWith(".vault")?e.path:`${e.path}.vault`;else t=a.resolve(process.cwd(),".env.vault");return n.existsSync(t)?t:null}function g(e){return"~"===e[0]?a.join(r.homedir(),e.slice(1)):e}const h={configDotenv:function(e){const t=a.resolve(process.cwd(),".env");let s="utf8";const r=Boolean(e&&e.debug);e&&e.encoding?s=e.encoding:r&&d("No encoding is specified. UTF-8 is used by default");let o,i=[t];if(e&&e.path)if(Array.isArray(e.path)){i=[];for(const t of e.path)i.push(g(t))}else i=[g(e.path)];const c={};for(const t of i)try{const a=h.parse(n.readFileSync(t,{encoding:s}));h.populate(c,a,e)}catch(e){r&&d(`Failed to load ${t} ${e.message}`),o=e}let u=process.env;return e&&null!=e.processEnv&&(u=e.processEnv),h.populate(u,c,e),o?{parsed:c,error:o}:{parsed:c}},_configVault:function(e){console.log(`[dotenv@${i}][INFO] Loading env from encrypted .env.vault`);const t=h._parseVault(e);let s=process.env;return e&&null!=e.processEnv&&(s=e.processEnv),h.populate(s,t,e),{parsed:t}},_parseVault:function(e){const t=l(e),s=h.configDotenv({path:t});if(!s.parsed){const e=new Error(`MISSING_DATA: Cannot parse ${t} for an unknown reason`);throw e.code="MISSING_DATA",e}const n=u(e).split(","),a=n.length;let r;for(let e=0;e<a;e++)try{const t=p(s,n[e].trim());r=h.decrypt(t.ciphertext,t.key);break}catch(t){if(e+1>=a)throw t}return h.parse(r)},config:function(e){if(0===u(e).length)return h.configDotenv(e);const t=l(e);return t?h._configVault(e):(s=`You set DOTENV_KEY but you are missing a .env.vault file at ${t}. Did you forget to build it?`,console.log(`[dotenv@${i}][WARN] ${s}`),h.configDotenv(e));var s},decrypt:function(e,t){const s=Buffer.from(t.slice(-64),"hex");let n=Buffer.from(e,"base64");const a=n.subarray(0,12),r=n.subarray(-16);n=n.subarray(12,-16);try{const e=o.createDecipheriv("aes-256-gcm",s,a);return e.setAuthTag(r),`${e.update(n)}${e.final()}`}catch(e){const t=e instanceof RangeError,s="Invalid key length"===e.message,n="Unsupported state or unable to authenticate data"===e.message;if(t||s){const e=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw e.code="INVALID_DOTENV_KEY",e}if(n){const e=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw e.code="DECRYPTION_FAILED",e}throw e}},parse:function(e){const t={};let s,n=e.toString();for(n=n.replace(/\r\n?/gm,"\n");null!=(s=c.exec(n));){const e=s[1];let n=s[2]||"";n=n.trim();const a=n[0];n=n.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),'"'===a&&(n=n.replace(/\\n/g,"\n"),n=n.replace(/\\r/g,"\r")),t[e]=n}return t},populate:function(e,t,s={}){const n=Boolean(s&&s.debug),a=Boolean(s&&s.override);if("object"!=typeof t){const e=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw e.code="OBJECT_REQUIRED",e}for(const s of Object.keys(t))Object.prototype.hasOwnProperty.call(e,s)?(!0===a&&(e[s]=t[s]),n&&d(!0===a?`"${s}" is already defined and WAS overwritten`:`"${s}" is already defined and was NOT overwritten`)):e[s]=t[s]}};e.exports.configDotenv=h.configDotenv,e.exports._configVault=h._configVault,e.exports._parseVault=h._parseVault,e.exports.config=h.config,e.exports.decrypt=h.decrypt,e.exports.parse=h.parse,e.exports.populate=h.populate,e.exports=h},496:e=>{"use strict";e.exports=require("aws-sdk")},486:e=>{"use strict";e.exports=require("bcrypt")},829:e=>{"use strict";e.exports=require("jsonwebtoken")},449:e=>{"use strict";e.exports=require("pg")},982:e=>{"use strict";e.exports=require("crypto")},896:e=>{"use strict";e.exports=require("fs")},857:e=>{"use strict";e.exports=require("os")},928:e=>{"use strict";e.exports=require("path")},583:e=>{"use strict";e.exports=JSON.parse('{"name":"dotenv","version":"16.4.5","description":"Loads environment variables from .env file","main":"lib/main.js","types":"lib/main.d.ts","exports":{".":{"types":"./lib/main.d.ts","require":"./lib/main.js","default":"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},"scripts":{"dts-check":"tsc --project tests/types/tsconfig.json","lint":"standard","lint-readme":"standard-markdown","pretest":"npm run lint && npm run dts-check","test":"tap tests/*.js --100 -Rspec","test:coverage":"tap --coverage-report=lcov","prerelease":"npm test","release":"standard-version"},"repository":{"type":"git","url":"git://github.com/motdotla/dotenv.git"},"funding":"https://dotenvx.com","keywords":["dotenv","env",".env","environment","variables","config","settings"],"readmeFilename":"README.md","license":"BSD-2-Clause","devDependencies":{"@definitelytyped/dtslint":"^0.0.133","@types/node":"^18.11.3","decache":"^4.6.1","sinon":"^14.0.1","standard":"^17.0.0","standard-markdown":"^7.1.0","standard-version":"^9.5.0","tap":"^16.3.0","tar":"^6.1.11","typescript":"^4.8.4"},"engines":{"node":">=12"},"browser":{"fs":false}}')}},t={};function s(n){var a=t[n];if(void 0!==a)return a.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,s),r.exports}var n={};(()=>{"use strict";var e=n;Object.defineProperty(e,"__esModule",{value:!0}),e.handler=void 0;const t=s(490);e.handler=async e=>{const{httpMethod:s,path:n,pathParameters:a,queryStringParameters:r,headers:o,body:i}=e;console.log(`Received event: ${JSON.stringify(e)}`);try{if("/authenticate"===n&&"PUT"===s)return await(0,t.handleAuthenticate)(i||"{}");if("/packages"===n&&"POST"===s)return await(0,t.handleListPackages)(i||"[]",o,r||{});if("/reset"===n&&"DELETE"===s)return await(0,t.handleResetRegistry)(o);if("/package/byRegEx"===n&&"POST"===s)return await(0,t.handleSearchPackagesByRegEx)(i||"{}",o);if(n&&n.startsWith("/package/byName/")&&"GET"===s){const e=n.split("/").pop()||"";return await(0,t.handleGetPackageHistoryByName)(e,o)}if("/package"===n&&"POST"===s)return await(0,t.handleCreatePackage)(i||"{}",o);if(n&&n.startsWith("/package/")&&n.endsWith("/rate")&&"GET"===s){const e=n.split("/")[2];return await(0,t.handleGetPackageRating)(e,o)}if(n&&n.startsWith("/package/")&&n.endsWith("/cost")&&"GET"===s){const e=n.split("/")[2];return await(0,t.handleGetPackageCost)(e,o,r||{})}if(n&&n.startsWith("/package/")&&"GET"===s){const e=n.split("/")[2];return await(0,t.handleRetrievePackage)(e,o)}if(n&&n.startsWith("/package/")&&"PUT"===s){const e=n.split("/")[2];return await(0,t.handleUpdatePackage)(e,i||"{}",o)}if(n&&n.startsWith("/package/")&&"DELETE"===s){const e=n.split("/")[2];return await(0,t.handleDeletePackage)(e,o)}return"/tracks"===n&&"GET"===s?await(0,t.handleGetTracks)(o):{statusCode:404,body:JSON.stringify({message:"Endpoint not found."}),headers:{"Content-Type":"application/json"}}}catch(e){return console.error("Lambda Handler Error:",e),e.statusCode&&e.message?{statusCode:e.statusCode,body:JSON.stringify({message:e.message}),headers:{"Content-Type":"application/json"}}:{statusCode:500,body:JSON.stringify({message:"Internal server error."}),headers:{"Content-Type":"application/json"}}}}})(),module.exports=n})();